# z_pair

ä¸€ä¸ªåŸºäºUnixåŸŸå¥—æ¥å­—çš„è½»é‡çº§é«˜æ•ˆçº¿ç¨‹é€šçŸ¥åº“ï¼Œä¸“ä¸ºLinuxç³»ç»Ÿè®¾è®¡ã€‚

## âš¡ ç®€ä»‹

**è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Linuxçº¿ç¨‹é€šçŸ¥åº“ï¼Œä½¿ç”¨UnixåŸŸå¥—æ¥å­—æä¾›å¯é çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ã€‚** ğŸ˜Š

## ğŸ’» å·¥ä½œåŸç†
è¯¥åº“ä½¿ç”¨UnixåŸŸå¥—æ¥å­—å¯¹æ¥å®ç°çº¿ç¨‹é—´çš„éé˜»å¡é€šçŸ¥æœºåˆ¶ã€‚å½“å‘é€ä¿¡å·æ—¶ï¼Œä¼šå‘å¥—æ¥å­—å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€šè¿‡select()é«˜æ•ˆåœ°æ£€æµ‹è¿™ä¸ªä¿¡å·ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### **æ„å»º**

```bash
make        # æ„å»ºåº“å’Œæµ‹è¯•ç¨‹åº
make clean  # æ¸…ç†æ„å»ºæ–‡ä»¶
```

### **æµ‹è¯•**
è¿è¡Œæµ‹è¯•ç¨‹åºæ¥æŸ¥çœ‹é€šçŸ¥æœºåˆ¶çš„è¿è¡Œæƒ…å†µï¼š
```bash
./build/test
```

æµ‹è¯•ç¨‹åºæ¼”ç¤ºäº†ï¼š
- åˆ›å»ºz_pairå®ä¾‹
- å¤šä¸ªçº¿ç¨‹ä»¥ä¸åŒè¶…æ—¶æ—¶é—´ç­‰å¾…ä¿¡å·
- çº¿ç¨‹é—´çš„ä¿¡å·ä¼ é€’
- èµ„æºçš„æ­£ç¡®æ¸…ç†

## ğŸ“š ä½¿ç”¨æ–¹æ³•

### **åŸºæœ¬ç¤ºä¾‹**
```c
#include "z_pair.h"
#include <pthread.h>

void* worker_thread(void* arg) {
    struct z_pair* pair = (struct z_pair*)arg;
    
    // ç­‰å¾…ä¿¡å·ï¼Œè¶…æ—¶æ—¶é—´ä¸º1000æ¯«ç§’
    int result = z_pair_wait(pair, 1000);
    if (result == 1) {
        printf("æ”¶åˆ°ä¿¡å·ï¼\n");
    } else if (result == 0) {
        printf("ç­‰å¾…è¶…æ—¶\n");
    } else {
        printf("å‘ç”Ÿé”™è¯¯\n");
    }
    return NULL;
}

int main() {
    // åˆ›å»ºz_pairå®ä¾‹
    struct z_pair* pair = z_pair_create();
    if (!pair) {
        printf("åˆ›å»ºz_pairå¤±è´¥\n");
        return -1;
    }

    // åˆ›å»ºå·¥ä½œçº¿ç¨‹
    pthread_t thread;
    pthread_create(&thread, NULL, worker_thread, pair);

    // å»¶æ—¶ä¸€æ®µæ—¶é—´åå‘é€ä¿¡å·
    usleep(500 * 1000);  // å»¶æ—¶500æ¯«ç§’
    z_pair_signal(pair);

    // ç­‰å¾…çº¿ç¨‹å®Œæˆ
    pthread_join(thread, NULL);

    // æ¸…ç†èµ„æº
    z_pair_destroy(pair);
    return 0;
}
```

## ğŸ› ï¸ APIå‚è€ƒ

### z_pair_create
```c
struct z_pair* z_pair_create(void);
```
åˆ›å»ºæ–°çš„z_pairå®ä¾‹ç”¨äºçº¿ç¨‹é€šçŸ¥ã€‚
- è¿”å›å€¼ï¼šæŒ‡å‘z_pairç»“æ„çš„æŒ‡é’ˆï¼Œå¤±è´¥æ—¶è¿”å›NULL

### z_pair_signal
```c
void z_pair_signal(struct z_pair* pair);
```
å‘é€ä¿¡å·ä»¥å”¤é†’ç­‰å¾…åœ¨æ­¤z_pairå®ä¾‹ä¸Šçš„çº¿ç¨‹ã€‚
- çº¿ç¨‹å®‰å…¨ï¼šæ˜¯
- å¤šä¸ªä¿¡å·ä¼šåˆå¹¶ä¸ºä¸€ä¸ª

### z_pair_wait
```c
int z_pair_wait(struct z_pair* pair, int timeout_ms);
```
åœ¨z_pairå®ä¾‹ä¸Šç­‰å¾…ä¿¡å·ã€‚
- `timeout_ms`ï¼šè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ-1è¡¨ç¤ºæ— é™ç­‰å¾…
- è¿”å›å€¼ï¼š
  - 1ï¼šæ”¶åˆ°ä¿¡å·
  - 0ï¼šè¶…æ—¶
  - -1ï¼šå‘ç”Ÿé”™è¯¯

### z_pair_destroy
```c
void z_pair_destroy(struct z_pair* pair);
```
æ¸…ç†å¹¶é‡Šæ”¾ä¸z_pairå®ä¾‹å…³è”çš„æ‰€æœ‰èµ„æºã€‚

## ğŸ” ç‰¹æ€§
- éé˜»å¡é€šçŸ¥æœºåˆ¶
- æ”¯æŒè¶…æ—¶è®¾ç½®
- çº¿ç¨‹å®‰å…¨æ“ä½œ
- é«˜æ•ˆçš„ä¿¡å·åˆå¹¶
- æ¸…æ™°çš„èµ„æºç®¡ç†
- æœ€å°åŒ–ç³»ç»Ÿèµ„æºä½¿ç”¨

## ğŸ“‹ å®ç°ç»†èŠ‚
è¯¥åº“ä½¿ç”¨ï¼š
- UnixåŸŸå¥—æ¥å­—å®ç°é«˜æ•ˆçš„çº¿ç¨‹é—´é€šä¿¡
- éé˜»å¡I/Oæå‡æ€§èƒ½
- äº’æ–¥é”ä¿è¯çº¿ç¨‹å®‰å…¨
- Select()æ”¯æŒè¶…æ—¶æœºåˆ¶
- ä¿¡å·åˆå¹¶é˜²æ­¢è¿‡è½½

## ğŸ¤ è´¡çŒ®
æ¬¢è¿è´¡çŒ®ï¼éšæ—¶æäº¤é—®é¢˜å’Œæ‹‰å–è¯·æ±‚ã€‚

## ğŸ“„ è®¸å¯è¯
æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯å¼€æºã€‚
